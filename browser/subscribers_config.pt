<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      lang="en"
      metal:use-macro="here/prefs_main_template/macros/master"
      i18n:domain="minaraad">

    <metal:block metal:fill-slot="top_slot"
                tal:define="dummy python:request.set('disable_border',1)" />
    
    <body>
    <metal:block metal:fill-slot="prefs_configlet_main"
                 tal:define="session request/SESSION;">
        
        <h1 i18n:translate="heading_subscribers_overview">Subscribers overview</h1>
        
        <a class="link-parent"
        tal:attributes="href string: $portal_url/plone_control_panel"
        i18n:translate="label_up_to_plone_setup">
            Up to Site Setup
        </a>
        <tal:block tal:define="subscriptions view/subscriptions;">
            <div i18n:translate="title_subscription" 
                 style="font-weight:bold">Subscriptions</div>
            
            <tal:block tal:repeat="subscription subscriptions">
            <span tal:condition="not:subscription/category" 
                tal:omit-tag=""
                tal:define="extra_request string:category=${subscription/id}">
                <a tal:attributes="href string:${context/absolute_url}/subscribers_config.html?${extra_request}"
                   tal:content="subscription/id"
                   i18n:translate="" /> &nbsp; | &nbsp;
            </span>
            </tal:block>
            <a tal:attributes="href string:${context/absolute_url}/subscribers_config.html?category=Hearing"
               i18n:translate="">Hearing</a>
            <br />
            <br />
        </tal:block>
        <br />

        <tal:block tal:define="subscription session/category|nothing;
                               members view/getMembersOfSubscriptions">
        
        <form method="get"
              tal:attributes="action string:${context/absolute_url}/$template_id">

            <tal:block tal:condition="python:subscription == 'Hearing'">
                <input class="context"
                        type="hidden"
                        name="Hearing"
                        tal:attributes="value string:Hearing" />
                <div i18n:translate="" 
                     style="font-weight:bold">Hearing Themes</div>
                <tal:block tal:repeat="theme view/subscriptions">
                <tal:block tal:condition="theme/category">
                    <input type="checkbox"
                            class="noborder"
                            tal:attributes="tabindex tabindex/next;
                                            id string:theme;
                                            name string:theme;
                                            checked theme/checked;
                                            value string:${theme/id};" /> 
                    <span tal:content="theme/Title"
                    i18n:translate="" /> 
                    <br />
                </tal:block>
                </tal:block>
                <br />
                <input class="context"
                            type="submit"
                            name="form.button.ShowThemeSubscribers"
                            value="Theme subscribers"
                            i18n:attributes="value label_subscribersoverview;"
                            tal:attributes="tabindex tabindex/next;" />
            </tal:block>
                <input class="context"
                        type="hidden"
                        name="Hearing"
                        tal:attributes="value string:Hearing" />


            <tal:block tal:condition="members">
            <input class="context"
                    type="submit"
                    name="form.button.ExportEmail"
                    value="Export Email Subscribers"
                    i18n:attributes="value label_export_email;"
                    tal:attributes="tabindex tabindex/next;" />
        
            <input class="context"
                    type="submit"
                    name="form.button.ExportPost"
                    value="Export Post Subscribers"
                    i18n:attributes="value label_export_post;"
                    tal:attributes="tabindex tabindex/next;" />

            <input class="context"
                    type="hidden"
                    name=""
                    tal:attributes="value subscription" />
            </tal:block>
        </form>

        <table class="listing"
               tal:condition="members">
            <thead>
                <tr>
                    <th i18n:translate="label_gender">
                        Gender
                    </th>
                    <th i18n:translate="label_firstname">
                        First name
                    </th>
                    <th i18n:translate="label_lastname">
                        Last name
                    </th>
                    <th i18n:translate="label_company">
                        Company
                    </th>
                    <th i18n:translate="label_jobtitle">
                        Job title
                    </th>
                    <th i18n:translate="label_street">
                        Street
                    </th>
                    <th i18n:translate="label_housenumber">
                        House number
                    </th>
                    <th i18n:translate="label_bus">
                        Bus
                    </th>
                    <th i18n:translate="label_zipcode">
                        Zipcode
                    </th>
                    <th i18n:translate="label_city">
                        City
                    </th>
                    <th i18n:translate="label_country">
                        Country
                    </th>
                    <th i18n:translate="label_phonenumber">
                        Phone number
                    </th>
                    <th i18n:translate="label_email">
                        E-mail
                    </th>
                    <th />
                </tr>
            </thead>
            <tbody>
                <tr tal:repeat="member members">
                    <td tal:content="member/gender" />
                    <td tal:content="member/firstname" />
                    <td tal:content="member/fullname" />
                    <td tal:content="member/company" />
                    <td tal:content="member/jobtitle" />
                    <td tal:content="member/street" />
                    <td tal:content="member/housenumber" />
                    <td tal:content="member/bus" />
                    <td tal:content="member/zipcode" />
                    <td tal:content="member/city" />
                    <td tal:condition="python:member.country != 'Ander land'">
                        <span tal:replace ="member/country" />
                    </td>
                    <td tal:condition="python:member.country == 'Ander land'">
                        <span tal:replace ="member/other_country" />
                    </td>
                    <td tal:content="member/phonenumber" />
                    <td tal:content="member/email" />
                    <td>
                        <span tal:content="python:view.getSubscriptionType(member, subscription)" />
                    </td>
                </tr>
            </tbody>
        </table>
        </tal:block>
    </metal:block>
    </body>
</html>
