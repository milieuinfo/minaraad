Notes on Minaraad Plone 4 migration
===================================

- Currently we have Plone 3.1.7.

- We should move to the latest stable release, currently Plone 4.1.2.

Installing on servers
---------------------

We first need a python 2.6 virtual env.

  > cd ~
  > mkdir virtual_envs
  > virtualenv -p /usr/bin/python2.6 py26_mina_plone4

Then we can use bootstrap with this new python.

 > cd
 > cd buildout
 > /home/zope/virtual_envs/py26_mina_plone4/bin/python2.6 bootstrap.py

We need the virtualenv otherwise we get an error saying distribute
can't be installed.


To do on Plone 3 through the web
--------------------------------

- Go to the portal_quickinstaller and uninstall CacheSetup.

- Go to the minaraad service panel (minaraad_service) linked in the
  Site Setup and search for duplicate email addresses ('Vind email
  adressen met meerdere gebruikers').  If any are found, use the links
  to delete the duplicates.  Two were reported at the time of writing,
  but Jurgen has removed them.

  Could be done in Plone 4 too, or you can manually remove them in the
  Users and Groups control panel, but it is better to clean them up soon.

- Uninstall emaillogin.

- Uninstall Products.FCKeditor (it gives a problem during migration
  and we probably want them to use TinyMCE).

- You have to manually remove some skin layers from the Plone Default
  skin selection:

  - cache_setup

  - emaillogin

  - fckeditorplone

  - fckeditor

- There is a difference between the minaraad Components registry and a
  default Plone 3.1.7 registry.  This should be added in minaraad while
  still using Plone 3.1.7, in the Components tab, otherwise you get a
  ComponentLookupError on IPortalTransformsTool when upgrading to
  Plone 4 (probably also fine to do this just before doing the Plone
  migration TTW)::

    <utility
       interface="Products.PortalTransforms.interfaces.IPortalTransformsTool"
       object="portal_transforms"/>

To do in the buildout
---------------------

- Check which versions can be removed from versions.cfg as they are
  already pinned elsewhere.  Preferably do not remove versions from no
  longer used recipes though, as the pins are needed for uninstall
  too.

- Test RelStorage with blobstorage.  TEST IT WELL!!!  There is some
  confusion (at least for me) between the names of the options and
  where to put them.  See:

  - http://pypi.python.org/pypi/RelStorage
  - http://pypi.python.org/pypi/plone.recipe.zope2instance


To do on Plone 4 through the web
--------------------------------

- Run the Plone migration.

- The site should fail now (no portlet_recent), that's "normal". Go to
  @@manage-portlets (at the root of the site) and remove
  the recent portlet.

- Go to the control panel then the skins, select "(Onbewerkt)".

- Go to the extra-products page and:
    - install diazo
    - install Quintagroup Captcha Core
    - install collective.emaillogin4
    - upgrade Simple attachments (note: this takes some time, so use a
      tunnel to access the instance directly. And it might reset the
      instance too, weird ...)
    - upgrade minaraad.projects
    - upgrade minaraad
   
- Go the the ZMI, portal_setup, import tab. Select "CMFEditions" and
  import all steps.

- Go to the Diazo configuration page, select the "Minaraad" theme.

- Add the following portlets on the homepage:
  - left column: Minaraad login, Minaraad personal preferences
  - right column: Minaraad search, LinkedIn, Minaraad recent changes

- Configure plone.app.caching (not much was previously cached in
  CacheSetup thouch).

- Set the default editor to TinyMCE (go to @@set-default-editor page)

