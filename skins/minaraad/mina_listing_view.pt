<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      lang="en"
      metal:use-macro="here/main_template/macros/master"
      i18n:domain="minaraad">

    <body>
    <metal:block metal:fill-slot="main">
    <metal:main-macro define-macro="main">
        <div metal:use-macro="here/document_actions/macros/document_actions">
            Document actions (print, sendto etc)
        </div>
      
        <h1 tal:content="context/Title" 
            class="documentFirstHeading" />
      
        <a class="link-parent"
           tal:define="parent_url python:here.navigationParent(here, template_id)"
           tal:condition="parent_url"
           tal:attributes="href parent_url"
           i18n:translate="go_to_parent_url">
            Up one level
        </a>
        <div tal:content="context/getDescription" />
        <br />
        <br />
        <metal:listingmacro define-macro="listing">
        <tal:foldercontents define="contentFilter contentFilter|request/contentFilter|nothing;
                limit_display limit_display|request/limit_display|nothing;
                more_url more_url|request/more_url|string:folder_contents;
                contentsMethod python:test(here.portal_type=='Topic', here.queryCatalog, here.getFolderContents);
                folderContents folderContents|python:contentsMethod(contentFilter, batch=True);
                use_view_action site_properties/typesUseViewActionInListings;
                over_limit python: limit_display and len(folderContents) > limit_display;
                folderContents python: (over_limit and folderContents[:limit_display]) or folderContents;
                batch folderContents;">
   
        <tal:listing condition="folderContents">
            <!-- Navigation -->
            <div metal:use-macro="here/batch_macros/macros/navigation" />
     
                <table width="100%"
                       metal:define-macro="listitem">
                    <tbody valign="top">
                    <tal:block tal:repeat="item folderContents">
                        <tal:block tal:define="item_url item/getURL|item/absolute_url;
                                        item_type item/portal_type;
                                        item_type_title item/Type;
                                        item_modified item/ModificationDate;
                                        item_created item/CreationDate;
                                        item_wf_state item/review_state|python: wtool.getInfoFor(item, 'review_state', '');
                                        item_creator item/Creator;
                                        item_start item/start/ISO|item/StartDate|nothing;
                                        item_end item/end/ISO|item/EndDate|nothing;
                                        item_object item/getObject;"
                                   tal:condition="python:(not item.exclude_from_nav)">
    
                        <tal:block tal:condition="python: context != item_object">

                        <!-- HEARING LISTING -->
                        <tr tal:condition="python:item_type=='Hearing'">
                            <td>
                                <div class="hearingsubheader2"
                                   tal:content="item_object/Title" />

                                <div tal:condition="item_object/getSubheader">
                                    <span tal:replace="item_object/getSubheader" />
                                    <span tal:condition="python:item_object.getMot() == True"
                                        tal:omit-tag="">
                                        (MOT)
                                    </span>
                                </div>
                                
                                <span tal:condition="item_object/getLocation">
                                    <span tal:replace="item_object/getLocation" /> 
                                    &nbsp;-&nbsp;
                                </span>

                                <!-- DATES -->
                                <tal:block tal:define="daterequired python:item_object.getStartdate() != None and item_object.getEnddate() != None;"
                                           tal:condition="daterequired">

                                <div tal:define="startdate python:item_object.toLocalizedTime(item_object.startdate);
                                                 enddate python:item_object.toLocalizedTime(item_object.enddate);
                                                starttime python:item_object.startdate.TimeMinutes();
                                                endtime python:item_object.enddate.TimeMinutes();
                                                noStartTime python:test(starttime == '00:00', 0, 1);
                                                noEndTime python:test(endtime == '00:00', 0, 1);"
                                     tal:omit-tag="">
                                    
    
                                        <tal:block tal:condition="python:startdate == enddate">
                                            <span tal:replace="startdate" />
                                            &nbsp;-&nbsp;
                                            <tal:block tal:condition="python: noStartTime and noEndTime">
                                                <span tal:replace="starttime" />
                                                <span i18n:translate="till"
                                                    tal:omit-tag="">till</span>
                                                <span tal:replace="endtime" />
                                                <span i18n:translate="hour">hour</span>
                                            </tal:block>
                                        </tal:block>
                                        <tal:block tal:condition="python:startdate != enddate">
                                            <span i18n:translate="from"
                                                tal:omit-tag="">from</span> 
                                            <span tal:replace="startdate" />
                                            
                                            <span i18n:translate="up_untill"
                                                tal:omit-tag="">up untill</span> 
                                            <span tal:replace="enddate" />
                        
                                            <tal:block tal:condition="python: noStartTime and noEndTime">
                                                &nbsp;-&nbsp;
                                                <span tal:replace="starttime" />
                                                
                                                <span i18n:translate="till"
                                                    tal:omit-tag="">till</span>
                                                <span tal:replace="endtime" />
                                                <span i18n:translate="hour">hour</span>
                                            </tal:block>
                                        </tal:block>
                                    </div>
                                </tal:block>
                                <br />
                                <span tal:condition="item/Description" 
                                      tal:content="item/Description" />
                                <a tal:attributes="href python:test(item_type in use_view_action, item_url+'/view', item_url+'/');"
                                   i18n:translate="linkmoreinfo">More</a>

                            </td>
                        </tr>
                        <!-- END HEARING LISTING -->

                        <!-- START ADVISORY LISTING -->
                        <tr tal:condition="python:item_type=='Advisory'">
                            <td>
                                <table class="advisory_listing">
                                    <tbody valign="top">
                                        <tr>
                                            <td tal:define="daterequired python:item_object.getDate() != None;
                                                            date python:item_object.toLocalizedTime(item_object.date)[:-5];"
                                                class="advisory_listdate"> 
                                                <span tal:condition="daterequired"
                                                    tal:replace="date" />
                                            </td>
                                            <td class="advisory_listtitle">
                                                <span tal:content="item_object/description" />
                                                <div tal:define="contacts python:item_object.getContact()"
                                                    tal:condition="contacts"
                                                    tal:omit-tag="">
                                                    
                                                <tal:block tal:repeat="contact contacts">
                                                    <a tal:attributes="href string:mailto:${contact/getEmail}"
                                                    tal:content="contact/getEmail" />
                                                </tal:block>
                                                </div>
                                                  <div tal:repeat="item item_object/getAttachments">
                                                    <span tal:define="item_type_class python:'contenttype-' + normalizeString(item_object['portal_type'])" 
                                                        tal:condition="python:item.get_size() &gt; 0"
                                                        tal:omit-tag="">
                                                        <br />
                                                        <a tal:attributes="href string:${item/absolute_url};
                                                                        class item_type_class"
                                                        tal:content="item/filename"> 
                                                            Attachment
                                                        </a>
                                                        <span class="filesize" 
                                                            tal:define="size python:item.getObjSize(item);"
                                                            tal:condition="size"
                                                            tal:content="size">
                                                            257 KB
                                                        </span>
                                                        <br />
                                                    </span>
                                                </div>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </td>
                        </tr>
                        <!-- END ADVISORY LISTING -->

                        </tal:block>
                        <tr>
                            <td height="10" />
                        </tr>
                        </tal:block>
                    </tal:block>
                    </tbody>
                </table>
     
                <div metal:use-macro="here/batch_macros/macros/navigation" />
            </tal:listing>
   
            <metal:empty metal:define-slot="no_items_in_listing">
            </metal:empty>
            </tal:foldercontents>
            </metal:listingmacro>
    </metal:main-macro>
    </metal:block>
  </body>
</html>