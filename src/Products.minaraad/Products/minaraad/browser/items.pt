<html xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      i18n:domain="plone">
  <body>

    <!--? Items -->
    <!--? Serie of conditions to render the right macro -->
    <!-- TODO: add more items? -->
    <metal:items metal:define-macro="related_item">

      <tal:block tal:condition="python:item.portal_type == 'Advisory'">
        <tal:block metal:use-macro="context/@@items/macros/advisory_link">
        </tal:block>
      </tal:block>

      <tal:block tal:condition="python:item.portal_type == 'MREvent'">
        <tal:block metal:use-macro="context/@@items/macros/event">
        </tal:block>
      </tal:block>

      <tal:block tal:condition="python:item.portal_type == 'Hearing'">
        <tal:block metal:use-macro="context/@@items/macros/hearing">
        </tal:block>
      </tal:block>

      <tal:block tal:condition="python:item.portal_type in ['File', 'FileAttachment']">
        <tal:block metal:use-macro="context/@@items/macros/attachment_view">
        </tal:block>
      </tal:block>

      <tal:block tal:condition="python:item.portal_type not in ['Advisory', 'MREvent', 'Hearing', 'File', 'FileAttachment']">
        <tal:block metal:use-macro="context/@@items/macros/general_link" />
      </tal:block>
    </metal:items>

    <!--? General item.  Used as fallback.  This should not be needed. -->
    <metal:block metal:define-macro="general_link">
      <article class="article-general">
        <a tal:attributes="href item/absolute_url">
          <div class="body">
            <h3 tal:content="item/Title"></h3>
            <p class="label" tal:condition="show_theme_title|nothing">
              <span tal:content="item/portal_type"/>
              <span tal:content="item/getThemeTitle|nothing"></span>
            </p>
            <p class="truncate" tal:content="item/Description"></p>
          </div>
        </a>
      </article>
    </metal:block>

    <!--? Advisory -->
    <metal:block metal:define-macro="advisory_link">
      <article class="article-advice">
        <a tal:attributes="href item/absolute_url">
          <tal:image
              tal:define="first_image item/get_first_image;
                          images first_image/@@images;
              thumbnail python:images.scale('image', width=648, height=365, direction='down')"
              tal:condition="thumbnail">
            <img tal:attributes="src thumbnail/url; alt item/title" />
          </tal:image>
          <div class="body">
            <h3 tal:content="item/Title"></h3>
            <p class="label" tal:condition="show_theme_title|nothing">
              Advies
              <span tal:content="item/getThemeTitle|nothing"></span>
            </p>
            <div class="truncate" tal:content="structure context/getPopular_summary|nothing" />
          </div>
        </a>
      </article>
    </metal:block>

    <!--? MREvent -->
    <metal:block metal:define-macro="event">
      <article class="article-event">
        <a tal:attributes="href item/absolute_url; title item/Title">
          <header>
            <h3 tal:define="d item/getStart_time|nothing">
              <i class="fa fa-comments"></i>
              <metal:block use-macro="context/display_macros/macros/date" />
            </h3>
          </header>
          <div class="body">
            <p class="label" tal:condition="show_theme_title|nothing">
              Evenement&emsp;
              <span tal:content="item/getThemeTitle|nothing"></span>
            </p>
            <h3 tal:content="item/Title"></h3>
            <p class="truncate" tal:content="context/Description|nothing" />
          </div>
        </a>
      </article>
    </metal:block>

    <!--? Hearing -->
    <metal:block metal:define-macro="hearing">
      <article class="article-next-meeting">
        <a href="event.html"
           tal:attributes="href item/absolute_url">
          <header>
            <h3>
              <i class="fa fa-gavel"></i>
              Volgende raadszitting
            </h3>
          </header>
          <div class="body">
            <time tal:define="toLocalizedTime nocall:context/@@plone/toLocalizedTime;
                              start item/getStart_time"
                  tal:attributes="datetime python: start.strftime('%Y-%m-%d %h:%m+01:00')"
                  tal:content="python: toLocalizedTime(start, long_format=1)">26 november 2015 9:30</time>
          </div>
        </a>
      </article>
    </metal:block>

    <!--? Study link -->
    <metal:block metal:define-macro="study">
      <h1>TODO: Study</h1>
    </metal:block>

    <metal:block metal:define-macro="listimageattachments"
                 tal:define="images context/get_images;
                             first_image context/get_first_image;">
      <tal:images condition="context/has_image">
        <aside class="images" data-featherlight-gallery data-featherlight-filter="a">
          <figure>
            <a tal:attributes="href string:${first_image/absolute_url}">
              <img tal:attributes="src string:${first_image/absolute_url}/image_preview;
                                   alt first_image/Title" />
            </a>
          </figure>
          <div class="thumbnails">
            <a tal:repeat="img python:images[1:]" tal:attributes="href string:${img/absolute_url}">
              <img tal:attributes="src string:${img/absolute_url}/image_thumb;
                                   alt string:img/Title" />
            </a>
          </div>
        </aside>
      </tal:images>
    </metal:block>

    <metal:block metal:define-macro="listattachments"
                 tal:define="attachments context/get_attachments">
      <tal:attachments condition="attachments">
        <h2>Downloads</h2>
        <div class="list-group-downloads">
          <tal:attachment repeat="item attachments">
            <metal:block use-macro="context/@@items/macros/attachment_view" />
          </tal:attachment>
        </div>
      </tal:attachments>
    </metal:block>

    <!-- Required definition before calling this macro: item.
         Optional: position (used in projects or meetings). -->
    <metal:block define-macro="attachment_view">
      <tal:block define="size item/getObjSize;
                         icon item/getIcon;
                         title item/Title|item/getId;
                         mimetype item/content_type|nothing;
                         uid item/UID;
                         contenttype python:mimetype if context.lookupMime(mimetype) else 'Onbekend';"
                 condition="python:size &gt; 0">
        <div class="list-group-item">
          <div class="icon">
            <!-- TODO: calculate which icon class to use. -->
            <!-- old code was this: -->
            <!-- <img tal:condition="icon" src="" alt="" -->
            <!--      tal:attributes="src string:${context/portal_url}/${icon}; -->
            <!--                      alt contenttype"/> -->
            <!-- some options: -->
            <!-- <i class="flaticon-docx1"></i> -->
            <!-- <i class="flaticon-xls2"></i> -->
            <i class="flaticon-pdf17"></i>
          </div>
          <div class="body">
            <h3 tal:content="title">ABC van het emissiehandels­systeem en prioriteiten van het EU-voorzitterschap</h3>
            <p class="label" tal:condition="show_theme_title|nothing">
              <span tal:content="item/getThemeTitle|nothing"></span>
            </p>
            <span tal:condition="position|nothing">
              Bijlage <span tal:replace="position" />:
            </span>
            <a class="btn"
               tal:attributes="href string:${item/getURL|item/absolute_url}/download;
                               id python: 'att_%s' % uid">
              Download
              <tal:ct content="contenttype">PDF -document</tal:ct>
              <tal:size content="size">95.6 KB</tal:size>
            </a>
            <tal:workflow condition="item/review_state|nothing">
              <!-- Workflow is used in the digibib.  TODO: untested, copied from filemacro.pt -->
              <tal:block define="can_edit python:context.portal_membership.checkPermission('Modify portal content', context);
                                 wf_helper context/@@attachment_workflow_helper|nothing;">

                <span i18n:domain="plone"
                      i18n:translate=""
                      tal:condition="not:can_edit"
                      tal:content="python:wf_helper.review_state_title(item)" />

                <dl class="actionMenu attachmentActionMenu"
                    i18n:domain="plone"
                    tal:condition="can_edit"
                    tal:attributes="id string:id-${item/UID}">
                  <dt class="actionMenuHeader">
                    <a class=""
                       tal:attributes="class python:'td-center state-' + item.review_state;
                                       href string:${item/getURL|item/absolute_url}/content_status_history;">
                      <span i18n:translate=""
                            tal:content="python:wf_helper.review_state_title(item)" />
                      <span tal:condition="python:wf_helper.transitions(item)"
                            class="arrowDownAlternative">&#9660;</span>
                    </a>
                  </dt>
                  <dd class="actionMenuContent">
                    <ul>
                      <li tal:repeat="trans python:wf_helper.transitions(item)">
                        <a i18n:translate=""
                           tal:content="trans/name"
                           tal:attributes="href string:${item/getURL}/content_status_modify?workflow_action=${trans/id};
                                           class string:kssattr-uid-${item/UID}" />
                      </li>
                    </ul>
                  </dd>
                </dl>
              </tal:block>
            </tal:workflow>
          </div>
        </div>
      </tal:block>
    </metal:block>

    <metal:block define-macro="related_documents"
                 tal:define="docs python:context.getRelatedDocuments();
                             show_theme_title python:True"
                 tal:condition="docs">
      <section class="sec-related">
        <div  class="container">
          <div class="sec-header">
            <h2><a href="#">Actuele documenten</a></h2>
          </div>
          <div class="row">
            <div class="column" tal:repeat="item docs">
              <tal:block metal:use-macro="context/@@items/macros/related_item" />
            </div>
          </div>
        </div>
      </section>
    </metal:block>

    <metal:block define-macro="nextprev"
                 tal:define="nextprev context/@@helpers/nextprev;
                             prev nextprev/previous;
                             next nextprev/next;">
      <h2>Bladeren</h2>
      <p class="label">
        <span i18n:translate="" tal:replace="context/portal_type">Advies</span>
        <span tal:content="context/getThemeTitle">Biodiversiteit</span>
      </p>
      <ul>
        <li class="prev" tal:condition="python:prev is not None">
          <a href="#" tal:attributes="href prev/url"
                      tal:content="prev/title">
            Conferentie Luchtkwaliteit 2014</a>
        </li>
        <li class="next" tal:condition="python:next is not None">
          <a href="#" tal:attributes="href next/url"
                      tal:content="next/title">
            Vlaamse NME-dag 'Groene Economie'</a>
        </li>
      </ul>
    </metal:block>

    <metal:block define-macro="yeararchive">
    <h2>Archief</h2>
    <p class="label">
      <span i18n:translate=""
        tal:replace="context/portal_type">Advies</span><span
        tal:content="context/getThemeTitle">Biodiversiteit</span></p>
    <ul>
      <li tal:repeat="year context/@@helpers/years"><a href="#"
          tal:attributes="href year/url"
          tal:content="year/year">2014</a></li>
    </ul>
    </metal:block>

    <metal:block define-macro="themelist">
        <h2>Thema's</h2>
        <ul>
          <li tal:repeat="theme context/@@helpers/themes"
              tal:attributes="class theme/css_class">
            <a href="theme_detail.html"
               tal:attributes="href theme/url"
               tal:content="theme/title">Biodiversiteit</a></li>
        </ul>
    </metal:block>
  </body>
</html>
