<tal:sections tal:define="sitemap view/get_sitemap;
                          selected_tab python:view.selected_portal_tab"
     i18n:domain="plone">
    <h5 class="hiddenStructure" i18n:translate="heading_sections">Sections</h5>

    <ul id="portal-globalnav"
        tal:define="hidden_titles view/get_hidden_titles"
        ><li tal:define="current python: selected_tab == 'index_html'"
             tal:attributes="class python: current  and 'selected' or 'plain'">
      <a href="/">Home</a>      
      </li><tal:tabs tal:repeat="tab sitemap/children"
        ><li tal:define="tid tab/id;
                         ctitle tab/Title;
                         current python: selected_tab == tid;
                         display not: tab/no_display;
                         excluded_title python: ctitle in hidden_titles"
             tal:condition="python: display and not excluded_title"
             tal:attributes="id string:portaltab-${tid};
                             class python: current  and 'selected' or 'plain'"
            >
      <a href=""
                tal:content="ctitle"
                tal:attributes="href tab/getURL" />
          <ul class="portal-tabs-nav-items"
              tal:define="subitems tab/children|nothing"              
              tal:condition="subitems">
            
            <tal:repeat repeat="subitem subitems">
              <li class="portal-tabs-subitem-listitem"
                  tal:condition="not:subitem/no_display|nothing">
                <a class="portal-tabs-subitem-link"
                   tal:content="subitem/Title"
                   tal:attributes="href subitem/absolute_url" />
              </li>
            </tal:repeat>
          </ul>
    </li></tal:tabs></ul>
    <script type="text/javascript">
      (function($) {
        function show_sub_nav() {
          $(this).find('ul.portal-tabs-nav-items').show();
        }

        function hide_sub_nav() {
          $(this).find('ul.portal-tabs-nav-items').hide();
        }

        $(document).ready(function() {
          $('#portal-globalnav > li').mouseenter(show_sub_nav);
          $('#portal-globalnav > li').mouseleave(hide_sub_nav);

          tabs = $('ul.portal-tabs-nav-items');
          tabs.css({'display': 'none', 'position': 'absolute'});
          tabs.each(function() {
            $(this).find('li').css({'display': 'block'});
          });
          

          $('#portal-globalnav > li').each(function() {
            var el = $(this);
            el.find('ul').css({'left': el.offset().left - 17});
          });
        });
      })(jQuery)
    </script>

</tal:sections>